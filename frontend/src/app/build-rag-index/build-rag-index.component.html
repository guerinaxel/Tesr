<section class="rag-builder">
  <mat-card>
    <mat-card-header>
      <mat-card-title>Build RAG Index</mat-card-title>
      <mat-card-subtitle>
        Fournissez un chemin racine (facultatif) pour lancer la construction de l'index côté backend.
      </mat-card-subtitle>
    </mat-card-header>

    <mat-card-content>
      <form class="rag-builder__form" (ngSubmit)="onSubmit()">
        <mat-form-field appearance="outline">
          <mat-label>Project root</mat-label>
          <input
            matInput
            id="rootInput"
            name="root"
            type="text"
            [(ngModel)]="root"
            placeholder="/workspace/project"
            [disabled]="isSubmitting || isLoadingRoot"
            data-cy="root-input"
          />
          <mat-icon matSuffix aria-hidden="true">folder</mat-icon>
          <mat-hint>
            Optionnel&nbsp;: laissez vide pour la racine par défaut.
            <ng-container *ngIf="lastUsedRoot">Dernier chemin utilisé : {{ lastUsedRoot }}</ng-container>
          </mat-hint>
        </mat-form-field>

        <button
          mat-flat-button
          color="primary"
          type="submit"
          [disabled]="isSubmitting"
          data-cy="launch-button"
        >
          <mat-progress-spinner
            *ngIf="isSubmitting"
            mode="indeterminate"
            diameter="18"
            strokeWidth="3"
          ></mat-progress-spinner>
          <mat-icon *ngIf="!isSubmitting" aria-hidden="true">rocket_launch</mat-icon>
          <span>{{ isSubmitting ? 'Envoi...' : 'Lancer la construction' }}</span>
        </button>

        <button
          mat-stroked-button
          color="primary"
          type="button"
          [disabled]="isSubmitting || !lastUsedRoot"
          (click)="onRebuild()"
          data-cy="rebuild-button"
        >
          <mat-icon aria-hidden="true">replay</mat-icon>
          <span>Reconstruire avec le dernier chemin</span>
        </button>
      </form>

      <div
        *ngIf="toast"
        class="toast"
        [ngClass]="{
          'toast--success': toast.type === 'success',
          'toast--error': toast.type === 'error'
        }"
        role="status"
        data-cy="toast"
      >
        <mat-icon aria-hidden="true">
          {{ toast.type === 'success' ? 'check_circle' : 'error' }}
        </mat-icon>
        <span>{{ toast.message }}</span>
      </div>
    </mat-card-content>
  </mat-card>
</section>
